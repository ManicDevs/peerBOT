#include <stdio.h>
#include <string.h>
#include <pthread.h>

#include "ipfs/repo/init.h"
#include "ipfs/core/daemon.h"
#include "ipfs/util/thread_pool.h"

int g_argc;
char **g_argv;

void *start_daemon(void *_)
{
    int argc = g_argc;
    char **argv = g_argv;
    ipfs_daemon(argc, argv);

    return NULL;
}

/***
 * The beginning
 */
int main(int argc, char** argv)
{
    struct thpool_ *thp;

    g_argc = argc;
    g_argv = argv;

    ipfs_repo_init(argc, argv);

    thp = thpool_init(1);
    thpool_add_work(thp, (void*)&start_daemon, (void*)NULL);

    while(1);

    return 0;
}
